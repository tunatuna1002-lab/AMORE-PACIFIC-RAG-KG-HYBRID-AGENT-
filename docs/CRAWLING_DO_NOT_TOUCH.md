# 크롤링 로직 수정 금지 (DO NOT TOUCH)

> **경고**: 이 문서를 읽지 않고 크롤링 관련 코드를 수정하지 마세요.

---

## 수정 금지 대상 파일

```
src/tools/amazon_scraper.py     ← 절대 수정 금지
src/agents/crawler_agent.py     ← 절대 수정 금지
src/tools/crawl_manager.py      ← 절대 수정 금지
```

---

## 왜 수정하면 안 되는가?

### 1. 현재 로직은 의도적으로 느리게 설계됨

```
카테고리1 ──60초──→ 카테고리2 ──60초──→ ... → 카테고리5
                    ↑
            AWS WAF 차단 방지를 위한 의도적 딜레이
```

### 2. AWS WAF 차단 패턴

Amazon은 다음 패턴을 감지하면 즉시 차단합니다:

| 패턴 | 결과 |
|------|------|
| 동시 다중 요청 | 🔴 IP 차단 |
| 짧은 간격 반복 요청 | 🔴 IP 차단 |
| 비정상적 요청 속도 | 🔴 IP 차단 |

### 3. 차단되면 발생하는 문제

- 해당 IP에서 Amazon 접근 불가 (며칠~몇 주)
- 일일 크롤링 데이터 수집 중단
- 대시보드/인사이트 서비스 전체 영향

---

## 자주 제안되는 (그러나 위험한) 개선안

### ❌ 병렬 크롤링

```python
# 이렇게 하면 안 됨!
results = await asyncio.gather(*[
    scrape_category(cat) for cat in categories
])
```

**문제**: 동시 5개 요청 → 즉시 차단

### ❌ 딜레이 단축

```python
# 이렇게 하면 안 됨!
await asyncio.sleep(5)  # 기존 30-60초 → 5초로 단축
```

**문제**: 요청 빈도 증가 → 차단 위험 급증

### ❌ 브라우저 인스턴스 다중화

```python
# 이렇게 하면 안 됨!
browsers = [await playwright.chromium.launch() for _ in range(5)]
```

**문제**: 동일 IP에서 다중 세션 → 더 빠른 차단

---

## 허용되는 수정 범위

다음 경우에만 수정을 고려할 수 있습니다:

### ✅ 버그 수정

- 크롤링 실패 시 에러 처리 개선
- 로깅 추가/개선
- 예외 상황 핸들링

### ✅ 차단 대응 강화

- 재시도 로직 개선 (현재 3회 → 조정)
- 차단 감지 정확도 향상
- 백오프 시간 증가 (더 느리게)

### ✅ 모니터링 추가

- 차단 횟수 통계
- 성공률 메트릭
- 알림 강화

---

## 크롤링 속도를 개선하고 싶다면?

다음 조건을 **모두** 충족해야 합니다:

1. **Proxy 로테이션 서비스 도입**
   - Bright Data, Oxylabs 등 유료 서비스
   - 월 $300-500 비용 발생

2. **IP당 요청 제한 구현**
   - 각 IP에서 분당 2-3개 요청만
   - Proxy pool 최소 10개 이상 필요

3. **충분한 테스트**
   - 스테이징 환경에서 1주일 이상 테스트
   - 차단 발생 시 즉시 롤백 가능

**위 조건 없이 속도 개선을 시도하지 마세요.**

---

## 문서 이력

| 날짜 | 작성자 | 내용 |
|------|--------|------|
| 2026-01-31 | AI Architecture Team | 최초 작성 |

---

## 관련 문서

- `CLAUDE.md` - 프로젝트 전체 가이드
- `.omc/plans/refactoring-plan-20260131.md` - 리팩토링 계획서

---

**이 문서에 대한 질문이 있으면 먼저 물어보세요. 코드를 수정하기 전에.**
