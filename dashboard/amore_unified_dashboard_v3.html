<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMORE INSIGHT | AI-Powered Beauty Market Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --amore-primary: #004691;
            --amore-secondary: #208080;
            --amore-accent: #00d1ff;
            --amore-danger: #e74c3c;
            --amore-success: #10b981;
            --amore-warning: #f59e0b;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        .app-container { display: flex; height: 100vh; overflow: hidden; }

        /* === SIDEBAR === */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, var(--amore-primary) 0%, #003366 100%);
            display: flex; flex-direction: column; flex-shrink: 0;
            box-shadow: 4px 0 24px rgba(0, 70, 145, 0.15); z-index: 50;
        }
        .logo-section { padding: 24px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon {
            width: 42px; height: 42px;
            background: linear-gradient(135deg, var(--amore-accent) 0%, var(--amore-secondary) 100%);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 209, 255, 0.3);
        }
        .logo-text { color: white; }
        .logo-text h1 { font-size: 18px; font-weight: 800; letter-spacing: -0.5px; }
        .logo-text span { font-size: 10px; opacity: 0.7; text-transform: uppercase; letter-spacing: 1px; }
        .nav-section { padding: 20px 16px; flex: 1; overflow-y: auto; }
        .nav-label { font-size: 10px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 12px; padding-left: 12px; font-weight: 600; }
        .nav-item {
            display: flex; align-items: center; gap: 12px;
            padding: 14px 16px; border-radius: 12px;
            color: rgba(255,255,255,0.7); cursor: pointer;
            transition: all 0.2s ease; margin-bottom: 4px;
            font-size: 14px; font-weight: 500;
        }
        .nav-item:hover { background: rgba(255,255,255,0.08); color: white; }
        .nav-item.active { background: rgba(255,255,255,0.15); color: white; font-weight: 600; }
        .nav-divider { height: 1px; background: rgba(255,255,255,0.1); margin: 16px 0; }
        .channel-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 16px; border-radius: 10px;
            color: rgba(255,255,255,0.8); font-size: 13px;
            background: rgba(255,255,255,0.05);
        }
        .channel-badge { font-size: 10px; background: rgba(0, 209, 255, 0.3); padding: 3px 10px; border-radius: 10px; color: white; }

        /* === MAIN === */
        .main-wrapper { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .header {
            height: 70px; background: white;
            border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 32px; flex-shrink: 0;
        }
        .header-left { display: flex; align-items: center; gap: 20px; }
        .page-info h2 { font-size: 18px; font-weight: 700; color: var(--text-primary); }
        .page-info .breadcrumb { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }
        .header-right { display: flex; align-items: center; gap: 16px; }
        .platform-badge {
            display: flex; align-items: center; gap: 8px;
            padding: 8px 16px; background: linear-gradient(135deg, #ff9900 0%, #cc7a00 100%);
            color: white; border-radius: 10px; font-size: 12px; font-weight: 600;
        }
        .export-btn {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white; border: none; border-radius: 10px;
            font-size: 13px; font-weight: 600; cursor: pointer;
            transition: all 0.2s; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        .export-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4); }
        .date-display { font-size: 12px; color: var(--text-secondary); background: #f8fafc; padding: 6px 12px; border-radius: 8px; font-weight: 500; }
        .time-display-group { display: flex; flex-direction: column; gap: 4px; align-items: flex-end; }
        .current-time { background: #e0f2fe; color: #0369a1; }

        /* === CRAWL STATUS === */
        .crawl-status {
            display: flex; align-items: center; gap: 8px;
            padding: 8px 14px; border-radius: 10px;
            font-size: 12px; font-weight: 600;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e; border: 1px solid #fcd34d;
        }
        .crawl-status.running { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; }
        .crawl-status.completed { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; border-color: #6ee7b7; }
        .crawl-status.failed { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #991b1b; border-color: #fca5a5; }
        .crawl-indicator {
            width: 8px; height: 8px; border-radius: 50%;
            background: #f59e0b; animation: pulse 1.5s infinite;
        }
        .crawl-status.completed .crawl-indicator { background: #10b981; animation: none; }
        .crawl-status.failed .crawl-indicator { background: #ef4444; animation: none; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }

        /* === TOAST NOTIFICATION === */
        @keyframes slideIn { from { opacity: 0; transform: translateX(100px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideOut { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(100px); } }

        .content-wrapper { flex: 1; display: flex; overflow: hidden; }
        .content-area { flex: 1; padding: 28px; overflow-y: auto; }
        .page-view { display: none; animation: fadeSlideIn 0.4s ease; }
        .page-view.active { display: block; }
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

        /* === INSIGHT BANNER === */
        .insight-banner {
            background: linear-gradient(135deg, var(--amore-primary) 0%, #1e3a5f 50%, var(--amore-secondary) 100%);
            border-radius: 20px; padding: 28px 32px; margin-bottom: 28px;
            position: relative; overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 70, 145, 0.25);
        }
        .insight-banner::before {
            content: ''; position: absolute; top: -50%; right: -20%;
            width: 400px; height: 400px;
            background: radial-gradient(circle, rgba(0, 209, 255, 0.15) 0%, transparent 70%);
        }
        .insight-content { display: flex; align-items: center; gap: 20px; position: relative; z-index: 1; }
        .insight-icon {
            width: 56px; height: 56px;
            background: rgba(255,255,255,0.15); backdrop-filter: blur(10px);
            border-radius: 16px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .insight-text { flex: 1; }
        .insight-label { font-size: 11px; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 2px; font-weight: 600; margin-bottom: 8px; }
        .insight-message { color: white; font-size: 17px; font-weight: 500; line-height: 1.6; }
        .insight-message strong { color: var(--amore-accent); }

        /* === STATUS CARDS === */
        .status-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 28px; }
        .status-card {
            background: white; border-radius: 16px; padding: 24px;
            text-align: center; border: 1px solid var(--border-color);
            transition: all 0.3s ease; cursor: pointer;
        }
        .status-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08); border-color: var(--amore-primary); }
        .status-label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; margin-bottom: 12px; }
        .status-value { display: flex; align-items: center; justify-content: center; gap: 10px; }
        .status-value span { font-size: 20px; font-weight: 800; text-transform: uppercase; }
        .status-card.success .status-value { color: var(--amore-success); }
        .status-card.info .status-value { color: var(--amore-primary); }
        .status-card.danger .status-value { color: var(--amore-danger); }
        .status-card.danger { border-color: rgba(231, 76, 60, 0.3); background: rgba(231, 76, 60, 0.03); }

        /* === TOOLTIP === */
        .status-card.danger { position: relative; z-index: 1; }
        .status-card.danger:hover { z-index: 9999; }
        .warning-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: white;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 10000;
            box-shadow: 0 8px 24px rgba(0,0,0,0.35);
            margin-bottom: 8px;
        }
        .warning-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1e293b;
        }
        .warning-tooltip ul {
            list-style: none;
            text-align: left;
            margin: 0;
            padding: 0;
        }
        .warning-tooltip li {
            padding: 4px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .warning-tooltip li::before {
            content: 'âš ï¸';
            font-size: 10px;
        }
        .status-card.danger:hover .warning-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* === GRID & CARDS === */
        .content-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 28px; }
        .content-grid.single { grid-template-columns: 1fr; }
        .card { background: white; border-radius: 16px; border: 1px solid var(--border-color); overflow: hidden; transition: all 0.3s ease; }
        .card:hover { box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06); }
        .card-header { padding: 20px 24px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; }
        .card-title { display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: 700; color: var(--text-primary); }
        .card-title-icon {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, var(--amore-primary) 0%, var(--amore-secondary) 100%);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
        }
        .card-badge { font-size: 11px; padding: 4px 10px; border-radius: 20px; font-weight: 600; }
        .card-badge.danger { background: rgba(231, 76, 60, 0.1); color: var(--amore-danger); }
        .card-body { padding: 24px; }

        /* === ACTION TABLE === */
        .action-table { width: 100%; border-collapse: collapse; }
        .action-table th { text-align: left; padding: 12px 16px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-secondary); font-weight: 600; border-bottom: 2px solid var(--border-color); background: #f8fafc; }
        .action-table td { padding: 16px; border-bottom: 1px solid #f1f5f9; font-size: 13px; vertical-align: middle; }
        .action-table tr { transition: all 0.2s; cursor: pointer; }
        .action-table tr:hover { background: #f8fafc; }
        .priority-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 700; }
        .priority-badge.p1 { background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); color: #dc2626; }
        .priority-badge.p2 { background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); color: #d97706; }
        .action-tag { display: inline-block; padding: 5px 10px; border-radius: 6px; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .action-tag.monitor { background: #dbeafe; color: #1d4ed8; }
        .action-tag.risk { background: #fee2e2; color: #dc2626; }
        .action-tag.deep { background: #fef3c7; color: #d97706; }
        .product-info { display: flex; align-items: center; gap: 12px; }
        .product-avatar { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 12px; color: white; background: linear-gradient(135deg, var(--amore-secondary) 0%, #1a6666 100%); }
        .product-name { font-weight: 600; color: var(--text-primary); }
        .product-brand { font-size: 11px; color: var(--text-secondary); }
        .link-action { color: var(--amore-primary); font-size: 12px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 4px; transition: all 0.2s; }
        .link-action:hover { color: var(--amore-secondary); }

        /* === KPI CARDS === */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 28px; }
        .kpi-card { background: white; border-radius: 16px; padding: 24px; border: 1px solid var(--border-color); transition: all 0.3s ease; }
        .kpi-card:hover { border-color: var(--amore-primary); box-shadow: 0 8px 20px rgba(0, 70, 145, 0.08); }
        .kpi-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-secondary); font-weight: 600; margin-bottom: 12px; }
        .kpi-value { font-size: 32px; font-weight: 800; color: var(--amore-primary); margin-bottom: 8px; display: flex; align-items: baseline; gap: 6px; }
        .kpi-value .unit { font-size: 16px; font-weight: 500; color: var(--text-secondary); }
        .kpi-delta { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .kpi-delta.up { background: rgba(16, 185, 129, 0.1); color: var(--amore-success); }
        .kpi-delta.down { background: rgba(231, 76, 60, 0.1); color: var(--amore-danger); }

        /* === CHARTS === */
        .chart-container { position: relative; height: 280px; }
        .chart-guide { margin-top: 16px; padding: 14px 18px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-left: 4px solid var(--amore-primary); border-radius: 0 12px 12px 0; font-size: 12px; line-height: 1.7; color: var(--text-secondary); }
        .chart-guide strong { color: var(--text-primary); }

        /* === QUICK ACTIONS === */
        .quick-actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 28px; }
        .quick-action-btn { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 18px 24px; border-radius: 14px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; border: none; }
        .quick-action-btn.primary { background: linear-gradient(135deg, var(--amore-primary) 0%, #1e3a5f 100%); color: white; box-shadow: 0 4px 16px rgba(0, 70, 145, 0.3); }
        .quick-action-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0, 70, 145, 0.4); }
        .quick-action-btn.secondary { background: white; color: var(--amore-primary); border: 2px solid var(--amore-primary); }
        .quick-action-btn.secondary:hover { background: var(--amore-primary); color: white; }
        .quick-action-btn.accent { background: linear-gradient(135deg, var(--amore-secondary) 0%, #1a6666 100%); color: white; box-shadow: 0 4px 16px rgba(32, 128, 128, 0.3); }

        /* === CATEGORY TABS === */
        .category-tabs { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
        .category-tab {
            padding: 12px 24px; border-radius: 12px; font-size: 13px; font-weight: 600;
            cursor: pointer; transition: all 0.2s; border: 2px solid var(--border-color);
            background: white; color: var(--text-secondary);
        }
        .category-tab:hover { border-color: var(--amore-primary); color: var(--amore-primary); }
        .category-tab.active { background: var(--amore-primary); border-color: var(--amore-primary); color: white; }

        /* === PRODUCT SELECTOR === */
        .selector-group { display: flex; gap: 16px; margin-bottom: 24px; align-items: center; flex-wrap: wrap; }
        .selector-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
        .selector-dropdown {
            padding: 12px 20px; border-radius: 12px; border: 2px solid var(--border-color);
            font-size: 14px; font-weight: 600; cursor: pointer; background: white;
            min-width: 200px; outline: none; transition: all 0.2s;
        }
        .selector-dropdown:focus { border-color: var(--amore-primary); }

        /* === CHATBOT === */
        .chatbot-panel { width: 0; background: white; border-left: 1px solid var(--border-color); display: flex; flex-direction: column; transition: width 0.3s ease; overflow: hidden; }
        .chatbot-panel.open { width: 380px; }
        .chat-header { padding: 20px; background: linear-gradient(135deg, var(--amore-primary) 0%, var(--amore-secondary) 100%); color: white; flex-shrink: 0; }
        .chat-header-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        .chat-header h3 { display: flex; align-items: center; gap: 10px; font-size: 16px; font-weight: 700; }
        .chat-close { width: 32px; height: 32px; background: rgba(255,255,255,0.15); border: none; border-radius: 8px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .chat-subtitle { font-size: 11px; opacity: 0.8; }
        .chat-body { flex: 1; padding: 20px; overflow-y: auto; background: #f8fafc; }
        .chat-message { margin-bottom: 16px; }
        .chat-message.bot .bubble { background: white; border: 1px solid var(--border-color); border-radius: 16px 16px 16px 4px; padding: 14px 18px; font-size: 13px; line-height: 1.6; }
        .chat-message.user .bubble { background: linear-gradient(135deg, var(--amore-primary) 0%, #1e3a5f 100%); color: white; border-radius: 16px 16px 4px 16px; padding: 14px 18px; font-size: 13px; margin-left: auto; max-width: 85%; }
        .chat-message.bot .bubble strong { color: var(--amore-primary); }
        .chat-suggestions { padding: 16px 20px; border-top: 1px solid var(--border-color); background: white; }
        .suggestions-label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; margin-bottom: 12px; }
        .suggestion-chips { display: flex; flex-direction: column; gap: 8px; }
        .suggestion-chip { padding: 12px 16px; background: #f8fafc; border: 1px solid var(--border-color); border-radius: 12px; font-size: 12px; cursor: pointer; transition: all 0.2s; text-align: left; }
        .suggestion-chip:hover { background: rgba(0, 70, 145, 0.05); border-color: var(--amore-primary); color: var(--amore-primary); }
        .chat-input-area { padding: 16px 20px; border-top: 1px solid var(--border-color); display: flex; gap: 12px; }
        .chat-input { flex: 1; padding: 12px 18px; border: 1px solid var(--border-color); border-radius: 25px; font-size: 13px; outline: none; }
        .chat-input:focus { border-color: var(--amore-primary); }
        .chat-send { width: 44px; height: 44px; background: linear-gradient(135deg, var(--amore-primary) 0%, var(--amore-secondary) 100%); border: none; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        .chat-fab { position: fixed; bottom: 28px; right: 28px; width: 64px; height: 64px; background: linear-gradient(135deg, var(--amore-primary) 0%, var(--amore-secondary) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 6px 24px rgba(0, 70, 145, 0.4); z-index: 100; transition: all 0.3s; }
        .chat-fab:hover { transform: scale(1.08); }
        .chat-fab.hidden { opacity: 0; pointer-events: none; transform: scale(0.8); }

        /* === AI DRAWER === */
        .ai-drawer { position: fixed; top: 0; right: 0; width: 520px; height: 100vh; background: white; border-left: 1px solid var(--border-color); box-shadow: -8px 0 40px rgba(0, 0, 0, 0.15); z-index: 200; transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
        .ai-drawer.open { transform: translateX(0); }
        .drawer-header { padding: 24px; background: linear-gradient(135deg, var(--amore-primary) 0%, #1e3a5f 50%, var(--amore-secondary) 100%); color: white; display: flex; align-items: center; justify-content: space-between; }
        .drawer-header-left { display: flex; align-items: center; gap: 14px; }
        .drawer-icon { width: 48px; height: 48px; background: rgba(255,255,255,0.15); border-radius: 14px; display: flex; align-items: center; justify-content: center; }
        .drawer-header h3 { font-size: 18px; font-weight: 700; }
        .drawer-header p { font-size: 12px; opacity: 0.8; margin-top: 2px; }
        .drawer-close { width: 40px; height: 40px; background: rgba(255,255,255,0.1); border: none; border-radius: 10px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .drawer-content { flex: 1; padding: 28px; overflow-y: auto; }
        .insight-section { margin-bottom: 28px; }
        .insight-section-header { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; padding-left: 14px; border-left: 4px solid var(--amore-primary); }
        .insight-section-header h4 { font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--amore-primary); }
        .insight-box { background: #f8fafc; border: 1px solid var(--border-color); border-radius: 14px; padding: 20px; font-size: 14px; line-height: 1.8; }
        .insight-box strong { color: var(--amore-primary); }
        .insight-box em { color: var(--amore-secondary); font-style: normal; font-weight: 600; }
        .inference-path { display: flex; align-items: center; justify-content: center; gap: 16px; padding: 24px; background: #f8fafc; border-radius: 14px; }
        .path-node { padding: 10px 16px; background: white; border: 2px solid var(--border-color); border-radius: 10px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .path-node.highlight { border-color: var(--amore-primary); color: var(--amore-primary); }
        .drawer-actions { padding: 20px 28px; border-top: 1px solid var(--border-color); display: flex; gap: 12px; }
        .drawer-btn { flex: 1; padding: 14px; border-radius: 12px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .drawer-btn.primary { background: linear-gradient(135deg, var(--amore-primary) 0%, var(--amore-secondary) 100%); border: none; color: white; }
        .drawer-btn.secondary { background: white; border: 2px solid var(--border-color); color: var(--text-primary); }

        /* === EXPORT MODAL === */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 300; display: none; align-items: center; justify-content: center; }
        .modal-overlay.open { display: flex; }
        .modal-content { background: white; border-radius: 24px; width: 420px; padding: 32px; box-shadow: 0 24px 64px rgba(0, 0, 0, 0.2); }
        .modal-header { display: flex; align-items: center; gap: 16px; margin-bottom: 28px; }
        .modal-icon { width: 52px; height: 52px; background: linear-gradient(135deg, var(--amore-success) 0%, #059669 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; }
        .modal-header h3 { font-size: 20px; font-weight: 700; }
        .modal-header p { font-size: 13px; color: var(--text-secondary); margin-top: 4px; }
        .form-group { margin-bottom: 24px; }
        .form-label { display: block; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--text-secondary); margin-bottom: 10px; }
        .date-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .date-input { padding: 14px 16px; border: 1px solid var(--border-color); border-radius: 12px; font-size: 14px; outline: none; }
        .date-input:focus { border-color: var(--amore-primary); }
        .platform-fixed { padding: 14px 20px; background: linear-gradient(135deg, #ff9900 0%, #cc7a00 100%); color: white; border-radius: 12px; font-size: 14px; font-weight: 600; text-align: center; }
        .modal-actions { display: flex; gap: 12px; margin-top: 32px; }
        .modal-btn { flex: 1; padding: 16px; border-radius: 14px; font-size: 14px; font-weight: 600; cursor: pointer; }
        .modal-btn.cancel { background: #f1f5f9; border: none; color: var(--text-secondary); }
        .modal-btn.confirm { background: linear-gradient(135deg, var(--amore-success) 0%, #059669 100%); border: none; color: white; }

        .typing-indicator { display: flex; gap: 4px; padding: 14px 18px; background: white; border: 1px solid var(--border-color); border-radius: 16px 16px 16px 4px; width: fit-content; }
        .typing-indicator span { width: 8px; height: 8px; background: var(--amore-primary); border-radius: 50%; animation: typing 1s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 100% { opacity: 0.3; transform: translateY(0); } 50% { opacity: 1; transform: translateY(-4px); } }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon"><i data-lucide="sparkles" style="color: white; width: 22px; height: 22px;"></i></div>
                    <div class="logo-text"><h1>AMORE INSIGHT</h1><span>AI Intelligence v2.0</span></div>
                </div>
            </div>
            <nav class="nav-section">
                <div class="nav-label">Main Views</div>
                <div class="nav-item active" onclick="switchPage('home')" data-page="home"><i data-lucide="home" style="width: 18px; height: 18px;"></i>Home</div>
                <div class="nav-item" onclick="switchPage('brand')" data-page="brand"><i data-lucide="building-2" style="width: 18px; height: 18px;"></i>Brand View (L1)</div>
                <div class="nav-item" onclick="switchPage('category')" data-page="category"><i data-lucide="layers" style="width: 18px; height: 18px;"></i>Category View (L2)</div>
                <div class="nav-item" onclick="switchPage('product')" data-page="product"><i data-lucide="box" style="width: 18px; height: 18px;"></i>Product View (L3)</div>
                <div class="nav-divider"></div>
                <div class="nav-label">Market Channel</div>
                <div class="channel-item"><span>ğŸ‡ºğŸ‡¸ Amazon US</span><span class="channel-badge">Active</span></div>
            </nav>
        </aside>

        <!-- MAIN -->
        <div class="main-wrapper">
            <header class="header">
                <div class="header-left">
                    <div class="page-info"><h2 id="page-title">Home</h2><div class="breadcrumb" id="breadcrumb">Daily Insight & Action Board</div></div>
                </div>
                <div class="header-right">
                    <div class="time-display-group">
                        <div class="date-display" id="date-display">ğŸ“… ë°ì´í„°: ë¡œë”©ì¤‘...</div>
                        <div class="date-display current-time" id="current-time">ğŸ• í˜„ì¬: --:--:--</div>
                    </div>
                    <div class="crawl-status" id="crawl-status" style="display: none;">
                        <span class="crawl-indicator"></span>
                        <span class="crawl-text">ìˆ˜ì§‘ ì¤‘...</span>
                    </div>
                    <div class="platform-badge">ğŸ‡ºğŸ‡¸ Amazon US</div>
                    <button class="export-btn" onclick="openExportModal()"><i data-lucide="download" style="width: 16px; height: 16px;"></i>Export</button>
                </div>
            </header>

            <div class="content-wrapper">
                <main class="content-area">
                    <!-- HOME PAGE -->
                    <div id="page-home" class="page-view active">
                        <div class="insight-banner">
                            <div class="insight-content">
                                <div class="insight-icon"><i data-lucide="sparkles" style="color: white; width: 28px; height: 28px;"></i></div>
                                <div class="insight-text">
                                    <div class="insight-label">âœ¨ Daily AI Insight - Laneige</div>
                                    <div class="insight-message">Amazon US ë‚´ Laneige ë¸Œëœë“œëŠ” ì•ˆì •ì ì¸ ìƒìœ„ê¶Œì„ ìœ ì§€ ì¤‘ì…ë‹ˆë‹¤. <strong>Lip Sleeping Mask</strong>ê°€ 2ìœ„ë¡œ ìƒìŠ¹í–ˆìœ¼ë©°, Water Bank Creamì˜ í‰ì  í•˜ë½ì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>
                                </div>
                            </div>
                        </div>
                        <div class="status-grid">
                            <div class="status-card success"><div class="status-label">Laneige ë…¸ì¶œ ìƒíƒœ</div><div class="status-value"><i data-lucide="trending-up" style="width: 24px; height: 24px;"></i><span>Stable Up</span></div></div>
                            <div class="status-card info"><div class="status-label">ì¹´í…Œê³ ë¦¬ í¬ì§€ì…˜</div><div class="status-value"><i data-lucide="bar-chart-3" style="width: 24px; height: 24px;"></i><span>Top 3</span></div></div>
                            <div class="status-card danger" id="warningProductsCard">
                                <div class="status-label">ì£¼ì˜ ì œí’ˆ</div>
                                <div class="status-value"><i data-lucide="alert-octagon" style="width: 24px; height: 24px;"></i><span id="warningCount">2ê°œ</span></div>
                                <div class="warning-tooltip" id="warningTooltip">
                                    <div style="font-weight: 600; margin-bottom: 8px; color: #f59e0b;">âš ï¸ ì£¼ì˜ í•„ìš” ì œí’ˆ</div>
                                    <ul id="warningProductsList">
                                        <li>Water Bank Cream - í‰ì  í•˜ë½</li>
                                        <li>Lip Glowy Balm - ìˆœìœ„ ë³€ë™ì„±</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="content-grid single">
                            <div class="card">
                                <div class="card-header"><div class="card-title"><div class="card-title-icon"><i data-lucide="zap" style="color: white; width: 16px; height: 16px;"></i></div>Laneige ì•¡ì…˜ ë³´ë“œ</div><span class="card-badge danger">4ê±´ ëŒ€ê¸°</span></div>
                                <div class="card-body" style="padding: 0;">
                                    <table class="action-table">
                                        <thead><tr><th>ìš°ì„ ìˆœìœ„</th><th>ì œí’ˆ</th><th>ë¬¸ì œ ì‹ í˜¸</th><th>ì•¡ì…˜ íƒœê·¸</th><th>ìƒì„¸ ë¶„ì„</th></tr></thead>
                                        <tbody>
                                            <tr onclick="goToProductDetail('', 'Lip Sleeping Mask')"><td><span class="priority-badge p1">ğŸ”´ P1</span></td><td><div class="product-info"><div class="product-avatar">LN</div><div><div class="product-name">Lip Sleeping Mask</div><div class="product-brand">Berry</div></div></div></td><td>ìˆœìœ„ 3â†’2 (ìƒí–¥)</td><td><span class="action-tag monitor">MONITOR</span></td><td><a href="#" class="link-action" onclick="event.stopPropagation(); goToProductDetail('', 'Lip Sleeping Mask');">ìƒì„¸ ë¶„ì„ â†’</a></td></tr>
                                            <tr onclick="goToProductDetail('', 'Water Bank Cream')"><td><span class="priority-badge p1">ğŸ”´ P1</span></td><td><div class="product-info"><div class="product-avatar">LN</div><div><div class="product-name">Water Bank Cream</div><div class="product-brand">Blue Hyaluronic</div></div></div></td><td>í‰ì  3.98 (í•˜ë½)</td><td><span class="action-tag risk">CHECK</span></td><td><a href="#" class="link-action" onclick="event.stopPropagation(); goToProductDetail('', 'Water Bank Cream');">ìƒì„¸ ë¶„ì„ â†’</a></td></tr>
                                            <tr onclick="goToProductDetail('', 'Lip Glowy Balm')"><td><span class="priority-badge p2">ğŸŸ  P2</span></td><td><div class="product-info"><div class="product-avatar">LN</div><div><div class="product-name">Lip Glowy Balm</div><div class="product-brand">Berry</div></div></div></td><td>ìˆœìœ„ ë³€ë™ì„± ë†’ìŒ</td><td><span class="action-tag deep">DEEP DIVE</span></td><td><a href="#" class="link-action" onclick="event.stopPropagation(); goToProductDetail('', 'Lip Glowy Balm');">ìƒì„¸ ë¶„ì„ â†’</a></td></tr>
                                            <tr onclick="goToProductDetail('', 'Cream Skin Toner')"><td><span class="priority-badge p2">ğŸŸ  P2</span></td><td><div class="product-info"><div class="product-avatar">LN</div><div><div class="product-name">Cream Skin Toner</div><div class="product-brand">Refiner</div></div></div></td><td>ê²½ìŸì‚¬ ê°€ê²© í•˜ë½</td><td><span class="action-tag monitor">MONITOR</span></td><td><a href="#" class="link-action" onclick="event.stopPropagation(); goToProductDetail('', 'Cream Skin Toner');">ìƒì„¸ ë¶„ì„ â†’</a></td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="content-grid">
                            <div class="card"><div class="card-header"><div class="card-title"><div class="card-title-icon"><i data-lucide="pie-chart" style="color: white; width: 16px; height: 16px;"></i></div>Laneige ì œí’ˆë³„ SoS</div></div><div class="card-body"><div class="chart-container"><canvas id="sosChart"></canvas></div></div></div>
                            <div class="card"><div class="card-header"><div class="card-title"><div class="card-title-icon"><i data-lucide="trending-up" style="color: white; width: 16px; height: 16px;"></i></div>Laneige SoS ì¶”ì´ (7ì¼)</div></div><div class="card-body"><div class="chart-container"><canvas id="trendChart"></canvas></div></div></div>
                        </div>
                        <div class="quick-actions">
                            <button class="quick-action-btn secondary" onclick="switchPage('category')"><i data-lucide="layers" style="width: 18px; height: 18px;"></i>ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„</button>
                            <button class="quick-action-btn secondary" onclick="switchPage('product')"><i data-lucide="box" style="width: 18px; height: 18px;"></i>ì œí’ˆ ìƒì„¸ ë¶„ì„</button>
                            <button class="quick-action-btn primary" onclick="toggleChatbot()"><i data-lucide="message-square" style="width: 18px; height: 18px;"></i>AIì—ê²Œ ì§ˆë¬¸í•˜ê¸°</button>
                        </div>
                    </div>

                    <!-- BRAND PAGE (L1) -->
                    <div id="page-brand" class="page-view">
                        <div class="kpi-grid">
                            <div class="kpi-card"><div class="kpi-label">Laneige SoS</div><div class="kpi-value">44.0<span class="unit">%</span></div><span class="kpi-delta up">â–² 2.1%p</span></div>
                            <div class="kpi-card"><div class="kpi-label">Top10 Products</div><div class="kpi-value">4<span class="unit">ê°œ</span></div><span class="kpi-delta up">+1 ì¦ê°€</span></div>
                            <div class="kpi-card"><div class="kpi-label">Avg Rank</div><div class="kpi-value">53.6<span class="unit">ìœ„</span></div><span class="kpi-delta up">â–¼ 2.3ìœ„ ê°œì„ </span></div>
                            <div class="kpi-card"><div class="kpi-label">ì‹œì¥ HHI</div><div class="kpi-value">0.35</div><span class="kpi-delta">ì¤‘ê°„ ì§‘ì¤‘ë„</span></div>
                        </div>
                        <div class="content-grid single">
                            <div class="card"><div class="card-header"><div class="card-title"><div class="card-title-icon"><i data-lucide="scatter-chart" style="color: white; width: 16px; height: 16px;"></i></div>Laneige vs ê²½ìŸì‚¬ SoS Ã— Avg Rank</div></div><div class="card-body"><div class="chart-container"><canvas id="brandMatrixChart"></canvas></div><div class="chart-guide"><strong>í•´ì„ ê°€ì´ë“œ:</strong> ìš°ì¸¡ í•˜ë‹¨ = ë¬¼ëŸ‰ å¤š + ìƒìœ„ê¶Œ ê°•í•¨ (ì •ìƒ ì„±ì¥) / ìš°ì¸¡ ìƒë‹¨ = ë¬¼ëŸ‰ å¤š + ìƒìœ„ê¶Œ ì•½í•¨ (íš¨ìœ¨ ì•…í™”)</div></div></div>
                        </div>
                        <div class="quick-actions"><button class="quick-action-btn accent" onclick="openAIDrawer()"><i data-lucide="sparkles" style="width: 18px; height: 18px;"></i>AI ì „ëµ ë¦¬í¬íŠ¸ ìƒì„±</button></div>
                    </div>

                    <!-- CATEGORY PAGE (L2) -->
                    <div id="page-category" class="page-view">
                        <div class="category-tabs">
                            <div class="category-tab active" onclick="selectCategory('lip', this)">Lip Care</div>
                            <div class="category-tab" onclick="selectCategory('skin', this)">Skin Care</div>
                            <div class="category-tab" onclick="selectCategory('face', this)">Face Moisturizer</div>
                            <div class="category-tab" onclick="selectCategory('toner', this)">Toner</div>
                        </div>
                        <div class="kpi-grid">
                            <div class="kpi-card"><div class="kpi-label">Category SoS</div><div class="kpi-value" id="cat-sos">18.5<span class="unit">%</span></div><span class="kpi-delta up">Category Leader</span></div>
                            <div class="kpi-card"><div class="kpi-label">Laneige Rank</div><div class="kpi-value" id="cat-rank">#2</div><span class="kpi-delta up">1ìœ„ ê·¼ì ‘</span></div>
                            <div class="kpi-card"><div class="kpi-label">CPI Index</div><div class="kpi-value" id="cat-cpi">112<span class="unit">pt</span></div><span class="kpi-delta down">ê°€ê²© ê²½ìŸë ¥ í•˜ë½</span></div>
                            <div class="kpi-card"><div class="kpi-label">ì‹ ê·œ ê²½ìŸì</div><div class="kpi-value" id="cat-new">18<span class="unit">ê°œ</span></div><span class="kpi-delta down">ê²½ìŸ ì‹¬í™”</span></div>
                        </div>
                        <div class="content-grid single">
                            <div class="card"><div class="card-header"><div class="card-title"><div class="card-title-icon"><i data-lucide="bar-chart" style="color: white; width: 16px; height: 16px;"></i></div>CPI ì§€ìˆ˜ ì¶”ì´</div></div><div class="card-body"><div class="chart-container"><canvas id="cpiChart"></canvas></div><div class="chart-guide"><strong>CPI (Competitive Price Index):</strong> 100 ì´ìƒ = ê²½ìŸì‚¬ ëŒ€ë¹„ ê³ ê°€ / 100 ë¯¸ë§Œ = ê²½ìŸì‚¬ ëŒ€ë¹„ ì €ê°€. LaneigeëŠ” í”„ë¦¬ë¯¸ì—„ í¬ì§€ì…”ë‹ ìœ ì§€ ì¤‘</div></div></div>
                        </div>
                    </div>

                    <!-- PRODUCT PAGE (L3) -->
                    <div id="page-product" class="page-view">
                        <div class="selector-group">
                            <span class="selector-label">ì¹´í…Œê³ ë¦¬</span>
                            <select class="selector-dropdown" id="productCategory" onchange="updateProductList()">
                                <option value="lip">Lip Care</option>
                                <option value="skin">Skin Care</option>
                                <option value="face">Face Moisturizer</option>
                                <option value="toner">Toner</option>
                            </select>
                            <span class="selector-label">ì œí’ˆ</span>
                            <select class="selector-dropdown" id="productSelect" onchange="updateProductView()">
                                <option value="lip-mask-berry">Lip Sleeping Mask (Berry)</option>
                                <option value="lip-mask-original">Lip Sleeping Mask (Original)</option>
                                <option value="lip-glowy">Lip Glowy Balm</option>
                            </select>
                        </div>
                        <div class="kpi-grid">
                            <div class="kpi-card"><div class="kpi-label">Current Rank</div><div class="kpi-value" id="prod-rank">#2</div><span class="kpi-delta up" id="prod-rank-delta">â–² 1ìœ„ ìƒìŠ¹</span></div>
                            <div class="kpi-card"><div class="kpi-label">Volatility</div><div class="kpi-value" id="prod-vol">12<span class="unit">pt</span></div><span class="kpi-delta" id="prod-vol-delta">ì•ˆì •ì </span></div>
                            <div class="kpi-card"><div class="kpi-label">Rating</div><div class="kpi-value" id="prod-rating">4.5<span class="unit">â˜…</span></div><span class="kpi-delta up" id="prod-rating-delta">ìƒìœ„ 10%</span></div>
                            <div class="kpi-card"><div class="kpi-label">Stickiness</div><div class="kpi-value" id="prod-stick">92<span class="unit">pt</span></div><span class="kpi-delta up" id="prod-stick-delta">ê³ ì°©í™” ë†’ìŒ</span></div>
                        </div>
                        <div class="content-grid">
                            <div class="card"><div class="card-header"><div class="card-title"><div class="card-title-icon"><i data-lucide="line-chart" style="color: white; width: 16px; height: 16px;"></i></div>ìˆœìœ„ & ê°€ê²© ì¶”ì´ (vs ì¹´í…Œê³ ë¦¬ 1ìœ„)</div></div><div class="card-body"><div class="chart-container"><canvas id="rankTrendChart"></canvas></div><div class="chart-guide"><strong>ë¹„êµ ëŒ€ìƒ:</strong> Summer Fridays Lip Butter Balm (í˜„ì¬ ì¹´í…Œê³ ë¦¬ 1ìœ„)</div></div></div>
                            <div class="card"><div class="card-header"><div class="card-title"><div class="card-title-icon"><i data-lucide="grid-3x3" style="color: white; width: 16px; height: 16px;"></i></div>Laneige ì œí’ˆ ë§¤íŠ¸ë¦­ìŠ¤</div></div><div class="card-body"><div class="chart-container"><canvas id="productMatrixChart"></canvas></div><div class="chart-guide"><strong>4ë¶„ë©´ í•´ì„:</strong> ì¢Œí•˜ë‹¨(King) = ì•ˆì •ì  ìƒìœ„ê¶Œ / ì¢Œìƒë‹¨(Rising) = ê¸‰ë¶€ìƒ / ìš°í•˜ë‹¨(Lagging) = ì •ì²´ / ìš°ìƒë‹¨(Risk) = ìœ„í—˜</div></div></div>
                        </div>
                    </div>
                </main>

                <!-- CHATBOT -->
                <aside class="chatbot-panel" id="chatbotPanel">
                    <div class="chat-header">
                        <div class="chat-header-top"><h3><i data-lucide="bot" style="width: 20px; height: 20px;"></i>AI Insight Agent</h3><button class="chat-close" onclick="toggleChatbot()"><i data-lucide="x" style="width: 18px; height: 18px;"></i></button></div>
                        <div class="chat-subtitle">Laneige ë¸Œëœë“œ ë§ì¶¤ ì¸ì‚¬ì´íŠ¸</div>
                    </div>
                    <div class="chat-body" id="chatBody">
                        <div class="chat-message bot"><div class="bubble">ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹<br><br>ì˜¤ëŠ˜ <strong>Laneige Lip Sleeping Mask</strong>ê°€ 2ìœ„ë¡œ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤. ê²½ìŸì‚¬ ëŒ€ë¹„ ê°€ê²© ê²½ìŸë ¥ì´ ì¢‹ì€ ìƒí™©ì´ì—ìš”.<br><br>ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”!</div></div>
                    </div>
                    <div class="chat-suggestions">
                        <div class="suggestions-label">ì¶”ì²œ ì§ˆë¬¸</div>
                        <div class="suggestion-chips">
                            <div class="suggestion-chip" onclick="sendChatMessage('Lip Sleeping Mask ìƒìŠ¹ ì›ì¸ ë¶„ì„í•´ì¤˜')">ğŸ“ˆ Lip Mask ìƒìŠ¹ ì›ì¸</div>
                            <div class="suggestion-chip" onclick="sendChatMessage('Water Bank Cream í‰ì  í•˜ë½ ëŒ€ì‘ ì „ëµì€?')">ğŸ“‰ Water Bank í‰ì  ëŒ€ì‘</div>
                            <div class="suggestion-chip" onclick="sendChatMessage('ì˜¤ëŠ˜ ê°€ì¥ ì‹œê¸‰í•œ ì•¡ì…˜ì€?')">âš¡ ì‹œê¸‰í•œ ì•¡ì…˜</div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="chatInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleChatKeypress(event)">
                        <button class="chat-send" onclick="sendChatFromInput()"><i data-lucide="send" style="width: 18px; height: 18px;"></i></button>
                    </div>
                </aside>
            </div>
        </div>

        <div class="chat-fab" id="chatFab" onclick="toggleChatbot()"><i data-lucide="message-square" style="color: white; width: 28px; height: 28px;"></i></div>

        <!-- AI DRAWER -->
        <div class="ai-drawer" id="aiDrawer">
            <div class="drawer-header">
                <div class="drawer-header-left"><div class="drawer-icon"><i data-lucide="brain" style="color: white; width: 24px; height: 24px;"></i></div><div><h3>AI Strategy Report</h3><p>Laneige Amazon US Analysis</p></div></div>
                <button class="drawer-close" onclick="closeAIDrawer()"><i data-lucide="x" style="width: 20px; height: 20px;"></i></button>
            </div>
            <div class="drawer-content">
                <div class="insight-section">
                    <div class="insight-section-header"><i data-lucide="chart-bar" style="width: 16px; height: 16px; color: var(--amore-primary);"></i><h4>Strategy Summary</h4></div>
                    <div class="insight-box"><strong>Laneige</strong> ë¸Œëœë“œëŠ” Amazon US Lip Care ì¹´í…Œê³ ë¦¬ì—ì„œ <em>"Price-Quality Leader"</em> í¬ì§€ì…˜ì„ í™•ë³´í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br><br>í˜„ì¬ Lip Sleeping Maskì˜ ê°€ê²© ê²½ìŸë ¥ê³¼ ë†’ì€ í‰ì (4.5)ì„ í™œìš©í•œ <strong>SKU í™•ì¥ ì „ëµ</strong>ì´ ê¶Œì¥ë©ë‹ˆë‹¤.</div>
                </div>
                <div class="insight-section">
                    <div class="insight-section-header"><i data-lucide="git-branch" style="width: 16px; height: 16px; color: var(--amore-secondary);"></i><h4>Inference Path</h4></div>
                    <div class="inference-path"><div class="path-node highlight">Laneige</div><i data-lucide="arrow-right" style="width: 16px; height: 16px; color: var(--text-secondary);"></i><div class="path-node">Top2 Position</div><i data-lucide="arrow-right" style="width: 16px; height: 16px; color: var(--text-secondary);"></i><div class="path-node highlight">SKU Expansion</div></div>
                </div>
                <div class="insight-section">
                    <div class="insight-section-header"><i data-lucide="target" style="width: 16px; height: 16px; color: var(--amore-warning);"></i><h4>Recommended Actions</h4></div>
                    <div class="insight-box">1ï¸âƒ£ Lip Sleeping Mask ì‹ ê·œ í”Œë ˆì´ë²„(Mango, Vanilla) ì¶œì‹œ ê²€í† <br>2ï¸âƒ£ Water Bank Cream ë¦¬ë·° ë¶„ì„ â†’ ë¶€ì • í‚¤ì›Œë“œ ëŒ€ì‘<br>3ï¸âƒ£ ë²ˆë“¤ í”„ë¡œëª¨ì…˜ìœ¼ë¡œ ê°ë‹¨ê°€ ìƒìŠ¹ ìœ ë„</div>
                </div>
            </div>
            <div class="drawer-actions">
                <button class="drawer-btn secondary" onclick="copyStrategyReport()"><i data-lucide="copy" style="width: 16px; height: 16px;"></i>ë³µì‚¬</button>
                <button class="drawer-btn primary" onclick="shareStrategyReport()"><i data-lucide="mail" style="width: 16px; height: 16px;"></i>ê³µìœ </button>
            </div>
        </div>

        <!-- EXPORT MODAL -->
        <div class="modal-overlay" id="exportModal">
            <div class="modal-content">
                <div class="modal-header"><div class="modal-icon"><i data-lucide="file-spreadsheet" style="color: white; width: 26px; height: 26px;"></i></div><div><h3>ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3><p>Amazon US ë°ì´í„° ì¶”ì¶œ</p></div></div>
                <div class="form-group"><label class="form-label">ë¶„ì„ ê¸°ê°„</label><div class="date-inputs"><input type="date" class="date-input" value="2025-12-01"><input type="date" class="date-input" value="2025-12-26"></div></div>
                <div class="form-group"><label class="form-label">ëŒ€ìƒ í”Œë«í¼</label><div class="platform-fixed">ğŸ‡ºğŸ‡¸ Amazon US (ê³ ì •)</div></div>
                <div class="modal-actions"><button class="modal-btn cancel" onclick="closeExportModal()">ì·¨ì†Œ</button><button class="modal-btn confirm" onclick="executeExport()">ğŸ“¥ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ</button></div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        let currentPage = 'home', chatbotOpen = false, charts = {};

        // Dashboard Data (loaded from JSON)
        let dashboardData = null;

        // Default Product Data (fallback)
        let productData = {
            'lip-mask-berry': { rank: '#2', rankDelta: 'â–² 1ìœ„ ìƒìŠ¹', vol: '12', volDelta: 'ì•ˆì •ì ', rating: '4.5', ratingDelta: 'ìƒìœ„ 10%', stick: '92', stickDelta: 'ê³ ì°©í™” ë†’ìŒ' },
            'lip-mask-original': { rank: '#5', rankDelta: 'ìœ ì§€', vol: '8', volDelta: 'ë§¤ìš° ì•ˆì •', rating: '4.4', ratingDelta: 'ì–‘í˜¸', stick: '88', stickDelta: 'ë†’ìŒ' },
            'lip-glowy': { rank: '#12', rankDelta: 'â–¼ 2ìœ„ í•˜ë½', vol: '22', volDelta: 'ë³€ë™ì„± ë†’ìŒ', rating: '4.2', ratingDelta: 'í‰ê· ', stick: '65', stickDelta: 'ì¤‘ê°„' }
        };

        let categoryProducts = {
            'lip': [['lip-mask-berry', 'Lip Sleeping Mask (Berry)'], ['lip-mask-original', 'Lip Sleeping Mask (Original)'], ['lip-glowy', 'Lip Glowy Balm']],
            'skin': [['water-bank', 'Water Bank Blue Cream'], ['cream-skin', 'Cream Skin Toner']],
            'face': [['water-bank-moist', 'Water Bank Moisture Cream'], ['cica-sleep', 'Cica Sleeping Mask']],
            'toner': [['cream-skin-ref', 'Cream Skin Refiner'], ['clear-c', 'Clear-C Peeling Serum']]
        };

        // í¬ë¡¤ë§ ìƒíƒœ ê´€ë¦¬
        let crawlStatusInterval = null;
        let lastDataDate = null;  // ë§ˆì§€ë§‰ ë°ì´í„° ë‚ ì§œ ì¶”ì 

        // í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
        function showToast(message, type = 'info') {
            // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
            const existing = document.getElementById('toast-notification');
            if (existing) existing.remove();

            const toast = document.createElement('div');
            toast.id = 'toast-notification';
            toast.style.cssText = `
                position: fixed; bottom: 24px; right: 24px; z-index: 10000;
                padding: 16px 24px; border-radius: 12px;
                font-size: 14px; font-weight: 500;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease;
                display: flex; align-items: center; gap: 10px;
                ${type === 'success'
                    ? 'background: linear-gradient(135deg, #10b981, #059669); color: white;'
                    : type === 'error'
                    ? 'background: linear-gradient(135deg, #ef4444, #dc2626); color: white;'
                    : 'background: linear-gradient(135deg, #3b82f6, #2563eb); color: white;'}
            `;
            toast.innerHTML = `
                <span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);

            // 5ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // í¬ë¡¤ë§ ìƒíƒœ ì²´í¬ ë° UI ì—…ë°ì´íŠ¸
        async function checkCrawlStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/crawl/status`);
                if (!response.ok) return;

                const data = await response.json();
                const statusEl = document.getElementById('crawl-status');
                const textEl = statusEl?.querySelector('.crawl-text');

                if (!statusEl) return;

                if (data.status === 'running') {
                    statusEl.style.display = 'flex';
                    statusEl.className = 'crawl-status running';
                    textEl.textContent = `ìˆ˜ì§‘ ì¤‘... ${data.progress}%`;
                } else if (data.status === 'completed' && data.date === new Date().toISOString().split('T')[0]) {
                    statusEl.style.display = 'flex';
                    statusEl.className = 'crawl-status completed';
                    textEl.textContent = 'ì˜¤ëŠ˜ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ';

                    // ë°ì´í„° ë‚ ì§œê°€ ë³€ê²½ëìœ¼ë©´ ìƒˆë¡œê³ ì¹¨
                    if (lastDataDate !== data.date) {
                        showToast('ğŸ“Š ìƒˆ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ! ëª¨ë“  ì°¨íŠ¸ê°€ ìµœì‹  ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.', 'success');
                        await refreshDashboardData();
                        lastDataDate = data.date;

                        // ë°ì´í„° ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
                        updateDataTime();
                    }

                    // 5ì´ˆ í›„ ìˆ¨ê¹€
                    setTimeout(() => { statusEl.style.display = 'none'; }, 5000);
                } else if (data.status === 'failed') {
                    statusEl.style.display = 'flex';
                    statusEl.className = 'crawl-status failed';
                    textEl.textContent = 'ìˆ˜ì§‘ ì‹¤íŒ¨';
                    showToast('ë°ì´í„° ìˆ˜ì§‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    setTimeout(() => { statusEl.style.display = 'none'; }, 5000);
                } else {
                    statusEl.style.display = 'none';
                }

                // ì§„í–‰ ì¤‘ì´ ì•„ë‹ˆë©´ í´ë§ ì¤‘ë‹¨
                if (data.status !== 'running' && crawlStatusInterval) {
                    clearInterval(crawlStatusInterval);
                    crawlStatusInterval = null;
                }
            } catch (error) {
                console.warn('Failed to check crawl status:', error);
            }
        }

        // í¬ë¡¤ë§ ìƒíƒœ í´ë§ ì‹œì‘
        function startCrawlStatusPolling() {
            if (crawlStatusInterval) return;
            crawlStatusInterval = setInterval(checkCrawlStatus, 3000);
            checkCrawlStatus(); // ì¦‰ì‹œ í•œ ë²ˆ ì²´í¬
        }

        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (APIì—ì„œ ë¡œë“œ)
        async function refreshDashboardData() {
            try {
                // APIì—ì„œ ìµœì‹  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`${API_BASE}/api/data`);
                if (!response.ok) {
                    console.warn('API data not available, falling back to JSON file');
                    return await loadDashboardData();
                }

                dashboardData = await response.json();
                console.log('Dashboard data refreshed from API:', dashboardData.metadata);

                // UI ì—…ë°ì´íŠ¸ (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼)
                highlightUpdatedElements();
                updateDashboardFromData();
                initChartsForPage(currentPage);

                return true;
            } catch (error) {
                console.warn('Failed to refresh from API:', error);
                return await loadDashboardData();
            }
        }

        // ì—…ë°ì´íŠ¸ëœ ìš”ì†Œ í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼
        function highlightUpdatedElements() {
            const elements = document.querySelectorAll('.kpi-value, .insight-message, .metric-card');
            elements.forEach(el => {
                el.style.transition = 'background-color 0.5s ease';
                el.style.backgroundColor = 'rgba(16, 185, 129, 0.2)';
                setTimeout(() => {
                    el.style.backgroundColor = '';
                }, 2000);
            });

            // ì°¨íŠ¸ ì»¨í…Œì´ë„ˆë„ í•˜ì´ë¼ì´íŠ¸
            const chartContainers = document.querySelectorAll('.chart-container, canvas');
            chartContainers.forEach(el => {
                el.style.transition = 'box-shadow 0.5s ease';
                el.style.boxShadow = '0 0 20px rgba(16, 185, 129, 0.4)';
                setTimeout(() => {
                    el.style.boxShadow = '';
                }, 2000);
            });
        }

        // Load Dashboard Data (API ìš°ì„ , JSON fallback)
        async function loadDashboardData() {
            try {
                // 1. ë¨¼ì € APIì—ì„œ ì‹œë„
                let response = await fetch(`${API_BASE}/api/data`);

                // API ì‹¤íŒ¨ ì‹œ JSON íŒŒì¼ë¡œ í´ë°±
                if (!response.ok) {
                    console.warn('API not available, trying JSON file');
                    response = await fetch('../data/dashboard_data.json');
                }

                if (!response.ok) {
                    console.warn('Dashboard data not found');
                    return false;
                }

                dashboardData = await response.json();
                console.log('Dashboard data loaded:', dashboardData.metadata);

                // ë§ˆì§€ë§‰ ë°ì´í„° ë‚ ì§œ ì €ì¥ (ìƒˆë¡œê³ ì¹¨ ê°ì§€ìš©)
                lastDataDate = dashboardData.metadata?.data_date;

                // Update UI with loaded data
                updateDashboardFromData();

                // ì˜¤ëŠ˜ ë°ì´í„°ê°€ ì•„ë‹ˆë©´ í¬ë¡¤ë§ ìƒíƒœ ì²´í¬ ì‹œì‘
                const dataDate = dashboardData.metadata?.data_date;
                const today = new Date().toISOString().split('T')[0];
                if (dataDate !== today) {
                    startCrawlStatusPolling();
                }

                return true;
            } catch (error) {
                console.warn('Failed to load dashboard data:', error);
                // ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ ì‹œ í˜„ì¬ ë‚ ì§œ í‘œì‹œ
                const dateDisplay = document.getElementById('date-display');
                if (dateDisplay) {
                    dateDisplay.textContent = 'ğŸ“… ' + new Date().toISOString().split('T')[0];
                }
                return false;
            }
        }

        // Update Dashboard UI from loaded data
        function updateDashboardFromData() {
            if (!dashboardData) return;

            // Update date display - ë°ì´í„° ë‚ ì§œ ë˜ëŠ” í˜„ì¬ ë‚ ì§œ í‘œì‹œ
            const dateDisplay = document.getElementById('date-display');
            if (dateDisplay) {
                const dataDate = dashboardData.metadata?.data_date;
                const today = new Date().toISOString().split('T')[0];
                dateDisplay.textContent = 'ğŸ“… ' + (dataDate || today);
            }

            // Update Home page insight
            if (dashboardData.home?.insight_message) {
                const insightEl = document.querySelector('.insight-message');
                if (insightEl) insightEl.innerHTML = dashboardData.home.insight_message;
            }

            // Update status cards
            if (dashboardData.home?.status) {
                const status = dashboardData.home.status;
                const statusCards = document.querySelectorAll('.status-card');
                if (statusCards[0]) {
                    statusCards[0].querySelector('.status-value span').textContent = status.exposure || 'Stable';
                }
                if (statusCards[1]) {
                    statusCards[1].querySelector('.status-value span').textContent = status.position || 'Top 5';
                }
                if (statusCards[2]) {
                    statusCards[2].querySelector('.status-value span').textContent = (status.warning_count || 0) + 'ê°œ';
                }
            }

            // Update action items
            if (dashboardData.home?.action_items) {
                updateActionTable(dashboardData.home.action_items);
            }

            // Update Brand KPIs
            if (dashboardData.brand?.kpis) {
                const kpis = dashboardData.brand.kpis;
                const kpiCards = document.querySelectorAll('#page-brand .kpi-card');
                if (kpiCards[0]) kpiCards[0].querySelector('.kpi-value').innerHTML = kpis.sos + '<span class="unit">%</span>';
                if (kpiCards[1]) kpiCards[1].querySelector('.kpi-value').innerHTML = kpis.top10_count + '<span class="unit">ê°œ</span>';
                if (kpiCards[2]) kpiCards[2].querySelector('.kpi-value').innerHTML = kpis.avg_rank + '<span class="unit">ìœ„</span>';
                if (kpiCards[3]) kpiCards[3].querySelector('.kpi-value').textContent = kpis.hhi;
            }

            // Update product data from loaded data
            if (dashboardData.products) {
                productData = {};
                categoryProducts = { 'lip': [], 'skin': [], 'face': [], 'toner': [] };

                for (const [asin, product] of Object.entries(dashboardData.products)) {
                    const key = asin.toLowerCase().replace(/[^a-z0-9]/g, '-');
                    productData[key] = {
                        rank: '#' + product.rank,
                        rankDelta: product.rank_delta,
                        vol: String(product.volatility),
                        volDelta: product.volatility_status,
                        rating: String(product.rating),
                        ratingDelta: product.rating_delta,
                        stick: '85',
                        stickDelta: 'ë†’ìŒ'
                    };

                    // Add to category
                    const cat = product.category?.replace('_', '') || 'lip';
                    const catKey = cat.includes('lip') ? 'lip' : cat.includes('face') ? 'face' : cat.includes('toner') ? 'toner' : 'skin';
                    if (categoryProducts[catKey]) {
                        categoryProducts[catKey].push([key, product.name]);
                    }
                }
            }

            console.log('Dashboard UI updated from data');
        }

        // Update action table with dynamic data
        function updateActionTable(items) {
            const tbody = document.querySelector('.action-table tbody');
            if (!tbody || !items.length) return;

            tbody.innerHTML = items.map((item, idx) => `
                <tr onclick="goToProductDetail('${item.asin || ''}', '${item.product_name || ''}')">
                    <td><span class="priority-badge ${item.priority.toLowerCase()}">${item.priority === 'P1' ? 'ğŸ”´' : 'ğŸŸ '} ${item.priority}</span></td>
                    <td>
                        <div class="product-info">
                            <div class="product-avatar">LN</div>
                            <div>
                                <div class="product-name">${item.product_name}</div>
                                <div class="product-brand">${item.brand_variant || ''}</div>
                            </div>
                        </div>
                    </td>
                    <td>${item.signal}</td>
                    <td><span class="action-tag ${item.action_tag.toLowerCase()}">${item.action_tag}</span></td>
                    <td><a href="#" class="link-action" onclick="event.stopPropagation(); goToProductDetail('${item.asin || ''}', '${item.product_name || ''}');">ìƒì„¸ ë¶„ì„ â†’</a></td>
                </tr>
            `).join('');

            // ì£¼ì˜ ì œí’ˆ íˆ´íŒ ì—…ë°ì´íŠ¸
            updateWarningTooltip(items);
        }

        // ì£¼ì˜ ì œí’ˆ íˆ´íŒ ì—…ë°ì´íŠ¸
        function updateWarningTooltip(items) {
            const warningItems = items.filter(item => item.priority === 'P1' || item.action_tag === 'CHECK' || item.action_tag === 'RISK');
            const tooltipList = document.getElementById('warningProductsList');
            const warningCount = document.getElementById('warningCount');

            if (tooltipList && warningItems.length > 0) {
                tooltipList.innerHTML = warningItems.map(item =>
                    `<li>${item.product_name} - ${item.signal}</li>`
                ).join('');
                if (warningCount) warningCount.textContent = warningItems.length + 'ê°œ';
            }
        }

        // ì œí’ˆ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
        function goToProductDetail(asin, productName) {
            // ì œí’ˆ í˜ì´ì§€ë¡œ ì „í™˜
            switchPage('product');

            // ì œí’ˆ ì„ íƒ ë“œë¡­ë‹¤ìš´ì—ì„œ í•´ë‹¹ ì œí’ˆ ì°¾ê¸°
            const productSelect = document.getElementById('productSelect');
            if (productSelect && productName) {
                // ì œí’ˆëª…ìœ¼ë¡œ ì˜µì…˜ ì°¾ê¸°
                const options = productSelect.options;
                for (let i = 0; i < options.length; i++) {
                    if (options[i].textContent.includes(productName.split(' ')[0])) {
                        productSelect.selectedIndex = i;
                        updateProductView();
                        break;
                    }
                }
            }

            // ì±—ë´‡ ì—´ê³  í•´ë‹¹ ì œí’ˆ ë¶„ì„ ìš”ì²­
            setTimeout(() => {
                const chatInput = document.getElementById('chatInput');
                if (chatInput && productName) {
                    chatInput.value = `${productName} ì œí’ˆì˜ ìƒì„¸ ë¶„ì„ì„ í•´ì£¼ì„¸ìš”.`;
                    chatInput.focus();
                }
            }, 300);
        }

        function switchPage(pageId) {
            currentPage = pageId;
            document.querySelectorAll('.page-view').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${pageId}`).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(item => { item.classList.remove('active'); if (item.dataset.page === pageId) item.classList.add('active'); });
            const titles = { home: { title: 'Home', breadcrumb: 'Daily Insight & Action Board' }, brand: { title: 'Brand View (L1)', breadcrumb: 'Laneige ë¸Œëœë“œ ë¶„ì„' }, category: { title: 'Category View (L2)', breadcrumb: 'Amazon US ì¹´í…Œê³ ë¦¬ ë¶„ì„' }, product: { title: 'Product View (L3)', breadcrumb: 'Laneige ì œí’ˆ ìƒì„¸' } };
            document.getElementById('page-title').textContent = titles[pageId].title;
            document.getElementById('breadcrumb').textContent = titles[pageId].breadcrumb;
            initChartsForPage(pageId);
        }

        function selectCategory(cat, el) {
            document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');

            // ì¹´í…Œê³ ë¦¬ ID ë§¤í•‘
            const catMap = { 'lip': 'lip_care', 'skin': 'facial_skin_care', 'face': 'face_moisturizer', 'toner': 'toner' };
            const catId = catMap[cat] || cat;

            // JSON ë°ì´í„°ì—ì„œ ì¹´í…Œê³ ë¦¬ KPI ë¡œë“œ
            let data;
            if (dashboardData?.charts?.category_kpis?.[catId]) {
                const catKpi = dashboardData.charts.category_kpis[catId];
                data = {
                    sos: catKpi.sos || 0,
                    rank: '#' + (catKpi.best_rank || 'N/A'),
                    cpi: catKpi.cpi || 100,
                    new: catKpi.new_competitors || 0
                };
            } else {
                // Fallback ë°ì´í„°
                const fallback = { lip: { sos: '18.5', rank: '#2', cpi: '112', new: '18' }, skin: { sos: '12.3', rank: '#4', cpi: '108', new: '24' }, face: { sos: '15.1', rank: '#3', cpi: '115', new: '12' }, toner: { sos: '8.7', rank: '#6', cpi: '102', new: '31' } };
                data = fallback[cat] || { sos: 0, rank: '#N/A', cpi: 100, new: 0 };
            }

            document.getElementById('cat-sos').innerHTML = data.sos + '<span class="unit">%</span>';
            document.getElementById('cat-rank').textContent = data.rank;
            document.getElementById('cat-cpi').innerHTML = data.cpi + '<span class="unit">pt</span>';
            document.getElementById('cat-new').innerHTML = data.new + '<span class="unit">ê°œ</span>';
        }

        function updateProductList() {
            const cat = document.getElementById('productCategory').value;
            const select = document.getElementById('productSelect');
            select.innerHTML = '';
            categoryProducts[cat].forEach(p => { const opt = document.createElement('option'); opt.value = p[0]; opt.textContent = p[1]; select.appendChild(opt); });
            updateProductView();
        }

        function updateProductView() {
            const prod = document.getElementById('productSelect').value;
            const d = productData[prod] || { rank: '#10', rankDelta: '-', vol: '15', volDelta: '-', rating: '4.0', ratingDelta: '-', stick: '70', stickDelta: '-' };
            document.getElementById('prod-rank').textContent = d.rank;
            document.getElementById('prod-rank-delta').textContent = d.rankDelta;
            document.getElementById('prod-vol').innerHTML = d.vol + '<span class="unit">pt</span>';
            document.getElementById('prod-vol-delta').textContent = d.volDelta;
            document.getElementById('prod-rating').innerHTML = d.rating + '<span class="unit">â˜…</span>';
            document.getElementById('prod-rating-delta').textContent = d.ratingDelta;
            document.getElementById('prod-stick').innerHTML = d.stick + '<span class="unit">pt</span>';
            document.getElementById('prod-stick-delta').textContent = d.stickDelta;
        }

        // API ì„œë²„ ì£¼ì†Œ (ë°°í¬ í™˜ê²½ì—ì„œëŠ” í˜„ì¬ í˜¸ìŠ¤íŠ¸ ì‚¬ìš©, ë¡œì»¬ì—ì„œëŠ” localhost:8001)
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:8001'
            : window.location.origin;

        function toggleChatbot() { chatbotOpen = !chatbotOpen; document.getElementById('chatbotPanel').classList.toggle('open', chatbotOpen); document.getElementById('chatFab').classList.toggle('hidden', chatbotOpen); }

        // ì±—ë´‡ ë©”ì‹œì§€ ì „ì†¡ - LLM Orchestrator v2 API ì—°ë™
        async function sendChatMessage(msg) {
            const chatBody = document.getElementById('chatBody');

            // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
            chatBody.innerHTML += `<div class="chat-message user"><div class="bubble">${msg}</div></div>`;
            chatBody.innerHTML += `<div class="chat-message bot" id="typing"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
            chatBody.scrollTop = chatBody.scrollHeight;

            try {
                // v3 API í˜¸ì¶œ (Simple LLM Chat)
                const response = await fetch(`${API_BASE}/api/v3/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: msg })
                });

                // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ì œê±°
                const typingEl = document.getElementById('typing');
                if (typingEl) typingEl.remove();

                if (response.ok) {
                    const data = await response.json();

                    // í¬ë¡¤ë§ ì‹œì‘ ê°ì§€ ì‹œ í´ë§ ì‹œì‘
                    if (data.text.includes('ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì˜¤ëŠ˜ ë°ì´í„° ìˆ˜ì§‘')) {
                        startCrawlStatusPolling();
                    }

                    // ì‘ë‹µ í‘œì‹œ (ë§ˆí¬ë‹¤ìš´ ë³€í™˜)
                    let formattedResponse = data.text
                        .replace(/\n/g, '<br>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>');

                    // ì‚¬ìš©ëœ ë„êµ¬ í‘œì‹œ (ìˆìœ¼ë©´)
                    if (data.tools_used && data.tools_used.length > 0) {
                        const toolBadges = data.tools_used.map(t =>
                            `<span style="background:#e0f2fe;color:#0369a1;padding:2px 6px;border-radius:4px;font-size:9px;">ğŸ”§ ${t}</span>`
                        ).join(' ');
                        formattedResponse = toolBadges + '<br><br>' + formattedResponse;
                    }

                    chatBody.innerHTML += `<div class="chat-message bot"><div class="bubble">${formattedResponse}</div></div>`;

                    // í›„ì† ì§ˆë¬¸ ì œì•ˆ ì—…ë°ì´íŠ¸
                    updateSuggestions(data.suggestions);
                } else {
                    throw new Error('API ì‘ë‹µ ì˜¤ë¥˜');
                }
            } catch (error) {
                console.error('Chat API error:', error);

                // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ì œê±°
                const typingEl = document.getElementById('typing');
                if (typingEl) typingEl.remove();

                // í´ë°± ì‘ë‹µ (API ì—°ê²° ì‹¤íŒ¨ ì‹œ)
                let res = `<strong>ğŸ’¡ ì•ˆë‚´:</strong><br><br>í˜„ì¬ API ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><br>ì„œë²„ ì‹¤í–‰ ëª…ë ¹:<br><code>python dashboard_api.py</code>`;

                chatBody.innerHTML += `<div class="chat-message bot"><div class="bubble">${res}</div></div>`;
            }

            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // í›„ì† ì§ˆë¬¸ ì œì•ˆ ì—…ë°ì´íŠ¸
        function updateSuggestions(suggestions) {
            const chipsContainer = document.querySelector('.suggestion-chips');
            if (!chipsContainer || !suggestions) return;

            chipsContainer.innerHTML = suggestions.map(s =>
                `<div class="suggestion-chip" onclick="sendChatMessage('${s}')">${s}</div>`
            ).join('');
        }

        function sendChatFromInput() { const input = document.getElementById('chatInput'); if (input.value.trim()) { sendChatMessage(input.value); input.value = ''; } }
        function handleChatKeypress(e) { if (e.key === 'Enter') sendChatFromInput(); }
        function openAIDrawer() { document.getElementById('aiDrawer').classList.add('open'); }
        function closeAIDrawer() { document.getElementById('aiDrawer').classList.remove('open'); }

        // AI Strategy Report ë³µì‚¬ ê¸°ëŠ¥
        async function copyStrategyReport() {
            const drawerContent = document.querySelector('.drawer-content');
            if (!drawerContent) {
                alert('âŒ ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ë¦¬í¬íŠ¸ í…ìŠ¤íŠ¸ ì¶”ì¶œ
            const sections = drawerContent.querySelectorAll('.insight-section');
            let reportText = 'ğŸ“Š AI Strategy Report - Laneige Amazon US Analysis\n';
            reportText += '=' .repeat(50) + '\n\n';

            sections.forEach(section => {
                const header = section.querySelector('.insight-section-header h4');
                const content = section.querySelector('.insight-box, .inference-path');

                if (header) {
                    reportText += `â–¶ ${header.textContent}\n`;
                }

                if (content) {
                    // HTMLì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (br -> ì¤„ë°”ê¿ˆ, íƒœê·¸ ì œê±°)
                    let text = content.innerHTML
                        .replace(/<br\s*\/?>/gi, '\n')
                        .replace(/<strong>(.*?)<\/strong>/gi, '**$1**')
                        .replace(/<em>(.*?)<\/em>/gi, '"$1"')
                        .replace(/<[^>]+>/g, '')
                        .replace(/&nbsp;/g, ' ')
                        .trim();
                    reportText += text + '\n\n';
                }
            });

            reportText += '-'.repeat(50) + '\n';
            reportText += `ğŸ“… Generated: ${new Date().toLocaleString('ko-KR')}\n`;
            reportText += 'ğŸ¤– AMORE INSIGHT AI Intelligence v2.0';

            try {
                await navigator.clipboard.writeText(reportText);

                // ë²„íŠ¼ í”¼ë“œë°±
                const btn = document.querySelector('.drawer-btn.secondary');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i data-lucide="check" style="width: 16px; height: 16px;"></i>ë³µì‚¬ë¨!';
                btn.style.background = '#10b981';
                btn.style.color = 'white';

                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.style.background = '';
                    btn.style.color = '';
                    lucide.createIcons();
                }, 2000);

            } catch (err) {
                // Fallback: êµ¬í˜• ë¸Œë¼ìš°ì € ì§€ì›
                const textArea = document.createElement('textarea');
                textArea.value = reportText;
                textArea.style.position = 'fixed';
                textArea.style.left = '-9999px';
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('âœ… ë¦¬í¬íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        // AI Strategy Report ê³µìœ  ê¸°ëŠ¥
        async function shareStrategyReport() {
            const drawerContent = document.querySelector('.drawer-content');
            if (!drawerContent) {
                alert('âŒ ê³µìœ í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ë¦¬í¬íŠ¸ ìš”ì•½ í…ìŠ¤íŠ¸ ìƒì„±
            const summaryBox = drawerContent.querySelector('.insight-box');
            const summary = summaryBox ? summaryBox.textContent.trim() : 'Laneige Amazon US ì „ëµ ë¶„ì„ ë¦¬í¬íŠ¸';

            const reportTitle = 'AMORE INSIGHT - AI Strategy Report';
            const reportDate = new Date().toLocaleDateString('ko-KR');

            // Web Share API ì§€ì› í™•ì¸
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: reportTitle,
                        text: `ğŸ“Š ${reportTitle}\n\n${summary}\n\nğŸ“… ${reportDate}`,
                        url: window.location.href
                    });
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        // ì‚¬ìš©ìê°€ ì·¨ì†Œí•œ ê²Œ ì•„ë‹ˆë©´ ì´ë©”ì¼ í´ë°±
                        openEmailShare(reportTitle, summary);
                    }
                }
            } else {
                // Web Share API ë¯¸ì§€ì› ì‹œ ì´ë©”ì¼ë¡œ ê³µìœ 
                openEmailShare(reportTitle, summary);
            }
        }

        // ì´ë©”ì¼ ê³µìœ  (í´ë°±)
        function openEmailShare(title, content) {
            const subject = encodeURIComponent(title);
            const body = encodeURIComponent(
                `ğŸ“Š AI Strategy Report - Laneige Amazon US Analysis\n\n` +
                `${content}\n\n` +
                `-`.repeat(40) + `\n` +
                `ğŸ“… ìƒì„±ì¼: ${new Date().toLocaleString('ko-KR')}\n` +
                `ğŸ”— ëŒ€ì‹œë³´ë“œ: ${window.location.href}\n\n` +
                `ğŸ¤– AMORE INSIGHT AI Intelligence v2.0`
            );

            window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');

            // ë²„íŠ¼ í”¼ë“œë°±
            const btn = document.querySelector('.drawer-btn.primary');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i data-lucide="check" style="width: 16px; height: 16px;"></i>ë©”ì¼ ì—´ë¦¼!';

            setTimeout(() => {
                btn.innerHTML = originalHTML;
                lucide.createIcons();
            }, 2000);
        }
        function openExportModal() { document.getElementById('exportModal').classList.add('open'); }
        function closeExportModal() { document.getElementById('exportModal').classList.remove('open'); }

        // DOCX ë‚´ë³´ë‚´ê¸° - ë°±ì—”ë“œ API ì—°ë™
        async function executeExport() {
            const exportBtn = document.querySelector('.modal-btn.confirm');
            const originalText = exportBtn.textContent;
            exportBtn.textContent = 'â³ ìƒì„± ì¤‘...';
            exportBtn.disabled = true;

            try {
                const response = await fetch(`${API_BASE}/api/export/docx`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        include_strategy: true
                    })
                });

                if (response.ok) {
                    // Blobìœ¼ë¡œ ë³€í™˜ í›„ ë‹¤ìš´ë¡œë“œ
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;

                    // Content-Dispositionì—ì„œ íŒŒì¼ëª… ì¶”ì¶œ
                    const disposition = response.headers.get('Content-Disposition');
                    const filename = disposition
                        ? disposition.split('filename=')[1]?.replace(/"/g, '')
                        : `AMORE_Insight_Report_${new Date().toISOString().slice(0,10)}.docx`;

                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);

                    closeExportModal();
                    alert('âœ… ì¸ì‚¬ì´íŠ¸ ë¦¬í¬íŠ¸ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    throw new Error('Export API ì˜¤ë¥˜');
                }
            } catch (error) {
                console.error('Export error:', error);
                alert('âŒ ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨\n\nAPI ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.\nëª…ë ¹: python dashboard_api.py');
            } finally {
                exportBtn.textContent = originalText;
                exportBtn.disabled = false;
            }
        }

        function initChartsForPage(pageId) {
            Object.values(charts).forEach(c => c.destroy()); charts = {};
            const colors = { laneige: '#208080', competitor: '#ff9900', others: '#94a3b8', grid: 'rgba(0,0,0,0.05)' };
            const chartColors = ['#208080', '#2aa0a0', '#3bc0c0', '#5cd0d0', '#94a3b8'];
            const brandColors = ['#208080', '#ff9900', '#ffd700', '#ff69b4', '#6366f1', '#14b8a6', '#f97316', '#8b5cf6', '#ec4899', '#06b6d4'];

            if (pageId === 'home') {
                // SoS ë„ë„› ì°¨íŠ¸ - JSON ë°ì´í„° ì‚¬ìš©
                let sosLabels = ['Lip Sleeping Mask', 'Water Bank', 'Lip Glowy', 'Cream Skin', 'Others'];
                let sosData = [35, 25, 18, 12, 10];

                if (dashboardData?.charts?.product_sos) {
                    sosLabels = dashboardData.charts.product_sos.labels || sosLabels;
                    sosData = dashboardData.charts.product_sos.data || sosData;
                }

                charts.sos = new Chart(document.getElementById('sosChart').getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: sosLabels,
                        datasets: [{
                            data: sosData,
                            backgroundColor: chartColors.slice(0, sosLabels.length),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: { position: 'right', labels: { font: { size: 11 }, padding: 10, usePointStyle: true } }
                        }
                    }
                });

                // SoS íŠ¸ë Œë“œ ì°¨íŠ¸ - JSON ë°ì´í„° ì‚¬ìš©
                // ë™ì  fallback ë‚ ì§œ ìƒì„± (ìµœê·¼ 7ì¼)
                const generateRecentDates = (days = 7) => {
                    const dates = [];
                    for (let i = days - 1; i >= 0; i--) {
                        const d = new Date();
                        d.setDate(d.getDate() - i);
                        dates.push((d.getMonth() + 1).toString().padStart(2, '0') + '/' + d.getDate().toString().padStart(2, '0'));
                    }
                    return dates;
                };
                let trendLabels = generateRecentDates(7);
                let trendData = [0, 0, 0, 0, 0, 0, 0]; // ë°ì´í„° ì—†ì„ ì‹œ 0ìœ¼ë¡œ í‘œì‹œ

                if (dashboardData?.charts?.sos_trend) {
                    trendLabels = dashboardData.charts.sos_trend.labels || trendLabels;
                    trendData = dashboardData.charts.sos_trend.data || trendData;
                }

                charts.trend = new Chart(document.getElementById('trendChart').getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: trendLabels,
                        datasets: [{
                            label: 'Laneige SoS',
                            data: trendData,
                            borderColor: colors.laneige,
                            backgroundColor: 'rgba(32,128,128,0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { y: { grid: { color: colors.grid } }, x: { grid: { display: false } } }
                    }
                });
            }

            if (pageId === 'brand') {
                // ë¸Œëœë“œ ë§¤íŠ¸ë¦­ìŠ¤ ë²„ë¸” ì°¨íŠ¸ - JSON ë°ì´í„° ì‚¬ìš©
                let brandDatasets = [
                    { label: 'Laneige', data: [{x: 44, y: 53.6, r: 18}], backgroundColor: colors.laneige },
                    { label: 'Summer Fridays', data: [{x: 32, y: 42, r: 14}], backgroundColor: colors.competitor },
                    { label: 'Burt\'s Bees', data: [{x: 22, y: 48, r: 12}], backgroundColor: '#ffd700' },
                    { label: 'EOS', data: [{x: 18, y: 55, r: 10}], backgroundColor: '#ff69b4' }
                ];

                if (dashboardData?.charts?.brand_matrix && dashboardData.charts.brand_matrix.length > 0) {
                    brandDatasets = dashboardData.charts.brand_matrix.map((brand, idx) => ({
                        label: brand.brand,
                        data: [{ x: brand.sos, y: brand.avg_rank, r: brand.bubble_size }],
                        backgroundColor: brand.is_laneige ? colors.laneige : brandColors[idx % brandColors.length]
                    }));
                }

                // ë²„ë¸” í¬ê¸°ì— ë”°ë¥¸ ì¶• ë²”ìœ„ ê³„ì‚° (ë²„ë¸”ì´ ì˜ì—­ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡)
                const maxBubbleR = Math.max(...brandDatasets.flatMap(d => d.data.map(p => p.r || 10)));
                const allX = brandDatasets.flatMap(d => d.data.map(p => p.x));
                const allY = brandDatasets.flatMap(d => d.data.map(p => p.y));
                const xMin = Math.max(0, Math.min(...allX) - maxBubbleR * 0.3);
                const xMax = Math.max(...allX) + maxBubbleR * 0.3;
                const yMin = Math.max(1, Math.min(...allY) - maxBubbleR * 0.5);
                const yMax = Math.max(...allY) + maxBubbleR * 0.5;

                charts.brandMatrix = new Chart(document.getElementById('brandMatrixChart').getContext('2d'), {
                    type: 'bubble',
                    data: { datasets: brandDatasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        clip: false,  // ì°¨íŠ¸ ì˜ì—­ ë°–ìœ¼ë¡œ ë²„ë¸”ì´ ì˜ë¦¬ì§€ ì•Šë„ë¡
                        layout: {
                            padding: {
                                top: maxBubbleR + 10,
                                right: maxBubbleR + 10,
                                bottom: maxBubbleR + 10,
                                left: maxBubbleR + 10
                            }
                        },
                        plugins: { legend: { position: 'top', labels: { font: { size: 11 } } } },
                        scales: {
                            y: {
                                reverse: true,
                                title: { display: true, text: 'Avg Rank' },
                                grid: { color: colors.grid },
                                min: yMin,
                                max: yMax
                            },
                            x: {
                                title: { display: true, text: 'SoS (%)' },
                                grid: { color: colors.grid },
                                min: xMin,
                                max: xMax
                            }
                        }
                    }
                });
            }

            if (pageId === 'category') {
                // CPI ì¶”ì´ ì°¨íŠ¸ - JSON ë°ì´í„° ì‚¬ìš©
                // ë™ì  fallback ë‚ ì§œ ìƒì„± (ìµœê·¼ 7ì¼)
                const generateRecentDatesForCPI = (days = 7) => {
                    const dates = [];
                    for (let i = days - 1; i >= 0; i--) {
                        const d = new Date();
                        d.setDate(d.getDate() - i);
                        dates.push((d.getMonth() + 1).toString().padStart(2, '0') + '/' + d.getDate().toString().padStart(2, '0'));
                    }
                    return dates;
                };
                let cpiLabels = generateRecentDatesForCPI(7);
                let cpiData = [100, 100, 100, 100, 100, 100, 100]; // ê¸°ì¤€ì„  100ìœ¼ë¡œ ì´ˆê¸°í™”

                if (dashboardData?.charts?.cpi_trend) {
                    cpiLabels = dashboardData.charts.cpi_trend.labels || cpiLabels;
                    cpiData = dashboardData.charts.cpi_trend.data || cpiData;
                }

                // ê¸°ì¤€ì„  ë°ì´í„° ìƒì„±
                const baselineData = cpiLabels.map(() => 100);

                charts.cpi = new Chart(document.getElementById('cpiChart').getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: cpiLabels,
                        datasets: [
                            {
                                label: 'Laneige CPI',
                                data: cpiData,
                                borderColor: colors.laneige,
                                backgroundColor: 'rgba(32,128,128,0.1)',
                                tension: 0.4,
                                fill: true,
                                borderWidth: 3
                            },
                            {
                                label: 'ê¸°ì¤€ì„  (100)',
                                data: baselineData,
                                borderColor: '#94a3b8',
                                borderDash: [5, 5],
                                borderWidth: 2,
                                pointRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'top', labels: { font: { size: 11 } } } },
                        scales: { y: { min: 90, max: 250, grid: { color: colors.grid } }, x: { grid: { display: false } } }
                    }
                });
            }

            if (pageId === 'product') {
                // ì œí’ˆ ìˆœìœ„ ì¶”ì´ ì°¨íŠ¸ - JSON ë°ì´í„° ì‚¬ìš©
                // ë™ì  fallback ë‚ ì§œ ìƒì„± (ìµœê·¼ 7ì¼)
                const generateRecentDatesForRank = (days = 7) => {
                    const dates = [];
                    for (let i = days - 1; i >= 0; i--) {
                        const d = new Date();
                        d.setDate(d.getDate() - i);
                        dates.push((d.getMonth() + 1).toString().padStart(2, '0') + '/' + d.getDate().toString().padStart(2, '0'));
                    }
                    return dates;
                };
                let rankLabels = generateRecentDatesForRank(7);
                let rankDatasets = [
                    { label: 'ë°ì´í„° ë¡œë”© ì¤‘...', data: rankLabels.map(() => null), borderColor: colors.laneige, backgroundColor: 'rgba(32,128,128,0.1)', tension: 0.4, fill: true, borderWidth: 3 },
                    { label: '1ìœ„ ê¸°ì¤€ì„ ', data: rankLabels.map(() => 1), borderColor: colors.competitor, borderDash: [5, 5], tension: 0, borderWidth: 2 }
                ];

                if (dashboardData?.charts?.product_rank_trend) {
                    const prt = dashboardData.charts.product_rank_trend;
                    rankLabels = prt.labels || rankLabels;

                    if (prt.products && Object.keys(prt.products).length > 0) {
                        rankDatasets = Object.entries(prt.products).map(([asin, product], idx) => ({
                            label: product.name,
                            data: product.ranks.map(r => r || null),
                            borderColor: chartColors[idx % chartColors.length],
                            backgroundColor: idx === 0 ? 'rgba(32,128,128,0.1)' : 'transparent',
                            tension: 0.4,
                            fill: idx === 0,
                            borderWidth: 3
                        }));
                        // 1ìœ„ ê¸°ì¤€ì„  ì¶”ê°€
                        rankDatasets.push({
                            label: '1ìœ„ ê¸°ì¤€ì„ ',
                            data: rankLabels.map(() => 1),
                            borderColor: colors.competitor,
                            borderDash: [5, 5],
                            tension: 0,
                            borderWidth: 2,
                            pointRadius: 0
                        });
                    }
                }

                charts.rankTrend = new Chart(document.getElementById('rankTrendChart').getContext('2d'), {
                    type: 'line',
                    data: { labels: rankLabels, datasets: rankDatasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'top', labels: { font: { size: 11 } } } },
                        scales: {
                            y: { reverse: true, title: { display: true, text: 'Rank' }, min: 1, max: 20, grid: { color: colors.grid } },
                            x: { grid: { display: false } }
                        }
                    }
                });

                // ì œí’ˆ ë§¤íŠ¸ë¦­ìŠ¤ ë²„ë¸” ì°¨íŠ¸ - JSON ë°ì´í„° ì‚¬ìš©
                let matrixDatasets = [
                    { label: 'Lip Mask Berry', data: [{x: 2, y: 12, r: 16}], backgroundColor: 'rgba(16,185,129,0.7)' },
                    { label: 'Lip Mask Original', data: [{x: 5, y: 8, r: 14}], backgroundColor: colors.laneige },
                    { label: 'Lip Glowy Balm', data: [{x: 12, y: 22, r: 10}], backgroundColor: 'rgba(245,158,11,0.7)' },
                    { label: 'Water Bank', data: [{x: 8, y: 18, r: 12}], backgroundColor: 'rgba(231,76,60,0.7)' }
                ];

                if (dashboardData?.charts?.product_matrix && dashboardData.charts.product_matrix.length > 0) {
                    matrixDatasets = dashboardData.charts.product_matrix.map(product => ({
                        label: product.name,
                        data: [{ x: product.rank, y: product.volatility, r: product.bubble_size }],
                        backgroundColor: product.color
                    }));
                }

                charts.productMatrix = new Chart(document.getElementById('productMatrixChart').getContext('2d'), {
                    type: 'bubble',
                    data: { datasets: matrixDatasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'right', labels: { font: { size: 10 }, boxWidth: 12 } } },
                        scales: {
                            y: { title: { display: true, text: 'Volatility â†‘' }, min: 0, max: 60, grid: { color: colors.grid } },
                            x: { title: { display: true, text: 'Rank (â† ìš°ìˆ˜)' }, min: 0, max: 30, grid: { color: colors.grid } }
                        }
                    }
                });
            }
        }
        // ì‹œê°„ í¬ë§· í•¨ìˆ˜ (KST ê¸°ì¤€)
        function formatDateTime(isoString) {
            if (!isoString) return 'ì—†ìŒ';

            // íƒ€ì„ì¡´ ì •ë³´ê°€ ì—†ìœ¼ë©´ KST(+09:00)ë¡œ ê°„ì£¼
            let dateStr = isoString;
            if (!isoString.includes('+') && !isoString.includes('Z')) {
                dateStr = isoString + '+09:00';
            }

            const date = new Date(dateStr);

            // KSTë¡œ í‘œì‹œ (UTC+9)
            const kstOffset = 9 * 60; // ë¶„ ë‹¨ìœ„
            const localOffset = date.getTimezoneOffset(); // ë¶„ ë‹¨ìœ„ (UTC - ë¡œì»¬)
            const kstDate = new Date(date.getTime() + (kstOffset + localOffset) * 60 * 1000);

            const year = kstDate.getFullYear();
            const month = String(kstDate.getMonth() + 1).padStart(2, '0');
            const day = String(kstDate.getDate()).padStart(2, '0');
            const hours = String(kstDate.getHours()).padStart(2, '0');
            const minutes = String(kstDate.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }

        function formatCurrentTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        // ì‹¤ì‹œê°„ ì‹œê³„ ì‹œì‘
        function startClock() {
            function updateClock() {
                document.getElementById('current-time').textContent = `ğŸ• í˜„ì¬: ${formatCurrentTime()}`;
            }
            updateClock(); // ì¦‰ì‹œ ì‹¤í–‰
            setInterval(updateClock, 1000); // 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
        }

        // ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
        function updateDataTime() {
            if (dashboardData && dashboardData.metadata) {
                const generatedAt = dashboardData.metadata.generated_at;
                document.getElementById('date-display').textContent = `ğŸ“… ë°ì´í„°: ${formatDateTime(generatedAt)}`;
            } else {
                document.getElementById('date-display').textContent = 'ğŸ“… ë°ì´í„°: ì—†ìŒ';
            }
        }

        window.onload = async function() {
            startClock(); // ì‹¤ì‹œê°„ ì‹œê³„ ì‹œì‘
            await loadDashboardData();
            updateDataTime(); // ë°ì´í„° ì‹œê°„ ì—…ë°ì´íŠ¸
            switchPage('home');
        };
    </script>
</body>
</html>
